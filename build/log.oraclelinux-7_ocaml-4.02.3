Running this Dockerfile:
FROM ocaml/opam:oraclelinux-7_ocaml-4.02.3
RUN sudo -u opam sh -c "cd /home/opam/opam-repository && git pull origin master && opam update -u" && \
  sudo -u opam sh -c "cd /home/opam/opam-repository && git pull https://github.com/djs55/opam-repository.git shared-memory-ring.1.3.0 && opam update -u" && \
  sudo -u opam sh -c "opam depext -u shared-memory-ring" && \
  sudo -u opam sh -c "opam install -y -j 2 -v shared-memory-ring"Sending build context to Docker daemon 37.38 kB
Step 1 : FROM ocaml/opam:oraclelinux-7_ocaml-4.02.3
oraclelinux-7_ocaml-4.02.3: Pulling from ocaml/opam
a3ed95caeb02: Already exists
ffe36b360c6d: Already exists
a3ed95caeb02: Already exists
28c81cf3d0db: Pulling fs layer
41480cc518cd: Pulling fs layer
39432154eff0: Pulling fs layer
28c81cf3d0db: Waiting
39432154eff0: Waiting
41480cc518cd: Waiting
41480cc518cd: Verifying Checksum
41480cc518cd: Download complete
28c81cf3d0db: Verifying Checksum
28c81cf3d0db: Download complete
28c81cf3d0db: Pull complete
28c81cf3d0db: Pull complete
41480cc518cd: Pull complete
41480cc518cd: Pull complete
39432154eff0: Verifying Checksum
39432154eff0: Download complete
39432154eff0: Pull complete
39432154eff0: Pull complete
Digest: sha256:fb5af2961cf360e06d49516a409941b4a4f54cd4d26f3b0fa8b9c5804141e2cf
Status: Downloaded newer image for ocaml/opam:oraclelinux-7_ocaml-4.02.3
 ---> 50b4e35b4eea
Step 2 : RUN sudo -u opam sh -c "cd /home/opam/opam-repository && git pull origin master && opam update -u" &&   sudo -u opam sh -c "cd /home/opam/opam-repository && git pull https://github.com/djs55/opam-repository.git shared-memory-ring.1.3.0 && opam update -u" &&   sudo -u opam sh -c "opam depext -u shared-memory-ring" &&   sudo -u opam sh -c "opam install -y -j 2 -v shared-memory-ring"
 ---> Running in 5203d6910aff
[91mFrom git://github.com/ocaml/opam-repository
 * branch            master     -> FETCH_HEAD
[0mUpdating 8223d0d..753ff0e
Fast-forward
 packages/dbm/dbm.1.0/files/mkdir-stublibs.patch    | 17 ++++++++++
 packages/dbm/dbm.1.0/opam                          |  1 +
 packages/mirage/mirage.2.7.1/opam                  | 32 -------------------
 packages/mirage/mirage.2.7.1/url                   |  2 --
 .../mirage/{mirage.2.7.1 => mirage.2.7.2}/descr    |  0
 packages/mirage/mirage.2.7.2/opam                  | 36 ++++++++++++++++++++++
 packages/mirage/mirage.2.7.2/url                   |  2 ++
 .../shared-memory-ring.1.3.0/descr                 |  3 ++
 .../shared-memory-ring.1.3.0/findlib               |  1 +
 .../shared-memory-ring.1.3.0/opam                  | 26 ++++++++++++++++
 .../shared-memory-ring.1.3.0/url                   |  2 ++
 packages/vmnet/vmnet.1.0.0/opam                    |  3 +-
 packages/vmnet/vmnet.1.0.1/opam                    |  3 +-
 packages/vmnet/vmnet.1.0.2/opam                    |  3 +-
 packages/vmnet/vmnet.1.1.0/descr                   | 30 ++++++++++++++++++
 packages/vmnet/vmnet.1.1.0/opam                    | 25 +++++++++++++++
 packages/vmnet/vmnet.1.1.0/url                     |  2 ++
 17 files changed, 151 insertions(+), 37 deletions(-)
 create mode 100644 packages/dbm/dbm.1.0/files/mkdir-stublibs.patch
 delete mode 100644 packages/mirage/mirage.2.7.1/opam
 delete mode 100644 packages/mirage/mirage.2.7.1/url
 rename packages/mirage/{mirage.2.7.1 => mirage.2.7.2}/descr (100%)
 create mode 100644 packages/mirage/mirage.2.7.2/opam
 create mode 100644 packages/mirage/mirage.2.7.2/url
 create mode 100644 packages/shared-memory-ring/shared-memory-ring.1.3.0/descr
 create mode 100644 packages/shared-memory-ring/shared-memory-ring.1.3.0/findlib
 create mode 100644 packages/shared-memory-ring/shared-memory-ring.1.3.0/opam
 create mode 100644 packages/shared-memory-ring/shared-memory-ring.1.3.0/url
 create mode 100644 packages/vmnet/vmnet.1.1.0/descr
 create mode 100644 packages/vmnet/vmnet.1.1.0/opam
 create mode 100644 packages/vmnet/vmnet.1.1.0/url

=-=- Updating package repositories =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[default: local] Command started
[default: local] Command started
[default: local] Command started
[default] /home/opam/opam-repository synchronized

=-=- Synchronizing development packages -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[depext: git] Command started
[depext: git] Command started
[depext: git] Command started
[depext: git] Command started
[depext] https://github.com/ocaml/opam-depext.git already up-to-date

Everything as up-to-date as possible (run with --verbose to show unavailable
upgrades).
[91mFrom https://github.com/djs55/opam-repository
 * branch            shared-memory-ring.1.3.0 -> FETCH_HEAD
[0mAlready up-to-date.

=-=- Updating package repositories =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[default: local] Command started
[default: local] Command started
[default: local] Command started
[default] /home/opam/opam-repository synchronized

=-=- Synchronizing development packages -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[depext: git] Command started
[depext: git] Command started
[depext: git] Command started
[depext: git] Command started
[depext] https://github.com/ocaml/opam-depext.git already up-to-date

Everything as up-to-date as possible (run with --verbose to show unavailable
upgrades).
# Detecting depexts using flags: x86_64 linux oraclelinux
# No extra OS packages requirements found.
The following actions will be performed:
  - install conf-pkg-config    1.0                              [required by conf-ncurses]
  - install conf-m4            1                                [required by ocamlfind]
  - install conf-ncurses       1                                [required by ocamlfind]
  - install ocamlfind          1.6.2                            [required by shared-memory-ring]
  - install type_conv          113.00.02                        [required by cstruct]
  - install sexplib            113.33.00                        [required by cstruct]
  - install ppx_tools          4.02.3                           [required by shared-memory-ring]
  - install cppo               1.3.1                            [required by ocplib-endian]
  - install base-bytes         base                             [required by cstruct]
  - install lwt                2.5.1                            [required by shared-memory-ring]
  - install ocplib-endian      0.8                              [required by cstruct, mirage-profile]
  - install cstruct            1.9.0                            [required by shared-memory-ring]
  - install io-page            1.6.0                            [required by mirage-profile]
  - install mirage-profile     0.7.0                            [required by shared-memory-ring]
  - install shared-memory-ring 1.3.0    
===== 15 to install =====

=-=- Gathering sources =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[cppo: http] Command started
[cstruct: http] Command started
[io-page: http] Command started
[cppo: http] Command started
[io-page: http] Command started
[cstruct: http] Command started
[cstruct.1.9.0] https://github.com/mirage/ocaml-cstruct/archive/v1.9.0.tar.gz downloaded
[lwt: http] Command started
[cppo.1.3.1] https://github.com/mjambon/cppo/archive/v1.3.1.tar.gz downloaded
[mirage-profile: http] Command started
[io-page.1.6.0] https://github.com/mirage/io-page/archive/v1.6.0.tar.gz downloaded
[ocamlfind: http] Command started
[ocamlfind: http] Command started
[ocamlfind.1.6.2] http://download.camlcity.org/download/findlib-1.6.2.tar.gz downloaded
[ocplib-endian: http] Command started
[mirage-profile: http] Command started
[mirage-profile.0.7.0] https://github.com/mirage/mirage-profile/archive/v0.7.0.tar.gz downloaded
[ppx_tools: http] Command started
[ocplib-endian: http] Command started
[ocplib-endian.0.8] https://github.com/OCamlPro/ocplib-endian/archive/0.8.tar.gz downloaded
[sexplib: http] Command started
[ppx_tools: http] Command started
[ppx_tools.4.02.3] https://github.com/alainfrisch/ppx_tools/archive/v4.02.3.tar.gz downloaded
[shared-memory-ring: http] Command started
[sexplib: http] Command started
[sexplib.113.33.00] https://ocaml.janestreet.com/ocaml-core/113.33/files/sexplib-113.33.00.tar.gz downloaded
[type_conv: http] Command started
[shared-memory-ring: http] Command started
[shared-memory-ring.1.3.0] https://github.com/mirage/shared-memory-ring/archive/v1.3.0.tar.gz downloaded
[type_conv: http] Command started
[type_conv.113.00.02] https://ocaml.janestreet.com/ocaml-core/113.00/files/type_conv-113.00.02.tar.gz downloaded
[lwt: http] Command started
[lwt.2.5.1] https://github.com/ocsigen/lwt/archive/2.5.1.tar.gz downloaded

=-=- Processing actions -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[conf-m4: sh echo | m4] Command started
[conf-pkg-config: pkg-config] Command started
+ sh "-exc" "echo | m4" (CWD=/home/opam/.opam/4.02.3/build/conf-m4.1)
- 
- + echo
- + m4
-> installed conf-m4.1
+ pkg-config "--help" (CWD=/home/opam/.opam/4.02.3/build/conf-pkg-config.1.0)
- Usage:
-   pkg-config [OPTION...]
- 
- Help Options:
-   -h, --help                              Show help options
- 
- Application Options:
-   --version                               output version of pkg-config
-   --modversion                            output version for package
-   --atleast-pkgconfig-version=VERSION     require given version of pkg-config
-   --libs                                  output all linker flags
-   --static                                output linker flags for static linking
-   --short-errors                          print short errors
-   --libs-only-l                           output -l flags
-   --libs-only-other                       output other libs (e.g. -pthread)
-   --libs-only-L                           output -L flags
-   --cflags                                output all pre-processor and compiler flags
-   --cflags-only-I                         output -I flags
-   --cflags-only-other                     output cflags not covered by the cflags-only-I option
-   --variable=NAME                         get the value of variable named NAME
-   --define-variable=NAME=VALUE            set variable NAME to VALUE
-   --exists                                return 0 if the module(s) exist
-   --print-variables                       output list of variables defined by the module
-   --uninstalled                           return 0 if the uninstalled version of one or more module(s) or their dependencies will be used
-   --atleast-version=VERSION               return 0 if the module is at least version VERSION
-   --exact-version=VERSION                 return 0 if the module is at exactly version VERSION
-   --max-version=VERSION                   return 0 if the module is at no newer than version VERSION
-   --list-all                              list all known packages
-   --debug                                 show verbose debug information
-   --print-errors                          show verbose information about missing or conflicting packages,default if --cflags or --libs given on the command line
-   --silence-errors                        be silent about errors (default unless --cflags or --libsgiven on the command line)
-   --errors-to-stdout                      print errors from --print-errors to stdout not stderr
-   --print-provides                        print which packages the package provides
-   --print-requires                        print which packages the package requires
-   --print-requires-private                print which packages the package requires for static linking
- 
-> installed conf-pkg-config.1.0
[conf-ncurses: pkg-config ncurses] Command started
+ pkg-config "ncurses" (CWD=/home/opam/.opam/4.02.3/build/conf-ncurses.1)
[91m[ERROR] The compilation of conf-ncurses failed at "pkg-config ncurses".
[0m[91m
#=== ERROR while installing conf-ncurses.1 ====================================#
# opam-version         1.2.2 (2dee5d69c0bd29731e6cb2ee537f0adf72404ba4)
# os                   linux
# command              pkg-config ncurses
# path                 /home/opam/.opam/4.02.3/build/conf-ncurses.1
# compiler             4.02.3
# exit-code            1
# env-file             /home/opam/.opam/4.02.3/build/conf-ncurses.1/conf-ncurses-192-60459a.env
# stdout-file          /home/opam/.opam/4.02.3/build/conf-ncurses.1/conf-ncurses-192-60459a.out
# stderr-file          /home/opam/.opam/4.02.3/build/conf-ncurses.1/conf-ncurses-192-60459a.err

[0m

=-=- Error report -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
The following actions were aborted
  - install base-bytes         base     
  - install cppo               1.3.1    
  - install cstruct            1.9.0    
  - install io-page            1.6.0    
  - install lwt                2.5.1    
  - install mirage-profile     0.7.0    
  - install ocamlfind          1.6.2    
  - install ocplib-endian      0.8      
  - install ppx_tools          4.02.3   
  - install sexplib            113.33.00
  - install shared-memory-ring 1.3.0    
  - install type_conv          113.00.02
The following actions failed
  - install conf-ncurses 1
The following changes have been performed
  - install conf-m4         1  
  - install conf-pkg-config 1.0

=-=- conf-ncurses.1 troobleshooting -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
=> This package relies on external (system) dependencies that may be missing.
   `opam depext conf-ncurses.1' may help you find the correct installation for
   your system.
[91m
The former state can be restored with:
    opam switch import "~/.opam/4.02.3/backup/state-20160220134144.export"
'opam install -y -j 2 -v shared-memory-ring' failed.
[0mThe command '/bin/sh -c sudo -u opam sh -c "cd /home/opam/opam-repository && git pull origin master && opam update -u" &&   sudo -u opam sh -c "cd /home/opam/opam-repository && git pull https://github.com/djs55/opam-repository.git shared-memory-ring.1.3.0 && opam update -u" &&   sudo -u opam sh -c "opam depext -u shared-memory-ring" &&   sudo -u opam sh -c "opam install -y -j 2 -v shared-memory-ring"' returned a non-zero code: 4
