FROM ocaml/opam:alpine-3.3_ocaml-4.02.3
RUN sudo -u opam sh -c "cd /home/opam/opam-repository && git pull origin master && opam update -u" && \
  sudo -u opam sh -c "cd /home/opam/opam-repository && git pull https://github.com/samoht/opam-repository.git opam-publish/mirage.2.7.1 && opam update -u" && \
  sudo -u opam sh -c "opam depext -u mirage" && \
  sudo -u opam sh -c "opam install -y -j 2 -v mirage"